<%- include('header') %>

<!-- ì¹´í…Œê³ ë¦¬ íƒ­ + ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ | ë²„ì „: 2.2.0 | ìˆ˜ì •ì¼: 2026-02-09 -->
<% if (typeof categories !== 'undefined' && categories) { %>
<div class="flex gap-1 mb-4 border-b">
  <a href="/<%= typeof currentDate !== 'undefined' && currentDate !== today ? '?date=' + currentDate : '' %>"
    class="px-4 py-2 text-sm <%= !currentCategory ? 'tab-active' : 'tab-inactive' %>">
    ì „ì²´
  </a>
  <% Object.keys(categories).forEach(function(catId) { %>
  <a href="/?category=<%= catId %><%= typeof currentDate !== 'undefined' && currentDate !== today ? '&date=' + currentDate : '' %>"
    class="px-4 py-2 text-sm <%= currentCategory === catId ? 'tab-active' : 'tab-inactive' %>">
    <%= categories[catId].label %>
  </a>
  <% }); %>
</div>
<% } %>

<!-- ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ -->
<% if (typeof currentDate !== 'undefined') { %>
<div class="flex items-center justify-between mb-4">
  <div class="flex items-center gap-3">
    <% if (typeof prevDate !== 'undefined' && prevDate) { %>
    <a href="/?date=<%= prevDate %><%= currentCategory ? '&category=' + currentCategory : '' %>"
      class="text-sm text-blue-600 hover:text-blue-800">&larr; <%= prevDate %></a>
    <% } else { %>
    <span class="text-sm text-gray-300">&larr;</span>
    <% } %>

    <span class="text-sm font-semibold text-gray-700">
      <%= currentDate %><%= currentDate === today ? ' (ì˜¤ëŠ˜)' : '' %>
    </span>

    <% if (typeof nextDate !== 'undefined' && nextDate) { %>
    <a href="/?date=<%= nextDate %><%= currentCategory ? '&category=' + currentCategory : '' %>"
      class="text-sm text-blue-600 hover:text-blue-800"><%= nextDate %> &rarr;</a>
    <% } else if (currentDate !== today) { %>
    <a href="/<%= currentCategory ? '?category=' + currentCategory : '' %>"
      class="text-sm text-blue-600 hover:text-blue-800">ì˜¤ëŠ˜ &rarr;</a>
    <% } else { %>
    <span class="text-sm text-gray-300">&rarr;</span>
    <% } %>
  </div>
  <% if (curation) { %>
  <span class="text-sm text-gray-500"><%= curation.articles.length %>ê±´</span>
  <% } %>
</div>
<% } %>

<% if (curation && curation.articles.length > 0) { %>
  <% if (curation.weeklySummary) { %>
  <div class="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-5 mb-6">
    <h2 class="text-lg font-bold text-purple-800 mb-2">ì´ë²ˆ ì£¼ ìš”ì•½</h2>
    <div class="text-sm text-gray-700 whitespace-pre-line"><%= curation.weeklySummary %></div>
  </div>
  <% } %>

  <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
    <% curation.articles.forEach(function(article, idx) { %>
    <% var scoreClass = article.scores.total >= 70 ? 'score-high' : (article.scores.total >= 50 ? 'score-medium' : 'score-low'); %>
    <%
      var sourceLabels = { hackernews: 'HN', reddit: 'Reddit', lobsters: 'Lobsters', devto: 'Dev.to', arxiv: 'ArXiv', bluesky: 'Bluesky', coindesk: 'CoinDesk', cointelegraph: 'CoinTelegraph', theblock: 'The Block', decrypt: 'Decrypt', seekingalpha: 'SeekingAlpha', marketwatch: 'MarketWatch', yahoofinance: 'Yahoo Finance', cnbc: 'CNBC', coingecko: 'CoinGecko', defillama: 'DeFi Llama' };
      var sourceLabel = sourceLabels[article.source] || article.source;
      var sourceClass = 'source-' + article.source;
      var catLabel = '';
      if (typeof categories !== 'undefined' && categories && article.category && categories[article.category]) {
        catLabel = categories[article.category].label;
      }
      var collectedTime = '';
      if (article.collectedAt) {
        collectedTime = new Date(article.collectedAt).toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit' });
      }
    %>
    <div class="bg-white rounded-xl shadow-sm border hover:shadow-md transition p-4 <%= scoreClass %>">
      <div class="flex items-start justify-between gap-2 mb-2">
        <a href="<%= article.url %>" target="_blank" rel="noopener"
          class="text-sm font-semibold text-gray-800 hover:text-blue-600 line-clamp-2 flex-1">
          <%= article.title %>
        </a>
        <span class="shrink-0 text-xs font-bold bg-gray-100 text-gray-700 px-2 py-1 rounded">
          <%= article.scores.total %>ì 
        </span>
      </div>

      <div class="flex items-center gap-2 mb-3">
        <span class="text-xs text-white px-2 py-0.5 rounded <%= sourceClass %>"><%= sourceLabel %></span>
        <% if (catLabel && !currentCategory) { %>
        <span class="text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded"><%= catLabel %></span>
        <% } %>
        <% if (collectedTime) { %>
        <span class="text-xs text-gray-400" title="ìˆ˜ì§‘ ì‹œê°"><%= collectedTime %></span>
        <% } %>
        <% if (article.matchedKeyword) { %>
        <span class="text-xs text-gray-400"><%= article.matchedKeyword %></span>
        <% } %>
      </div>

      <% if (article.summary) { %>
      <div class="summary-text text-sm text-gray-600" id="summary-<%= idx %>">
        <%- article.summary %>
      </div>
      <button onclick="toggleSummary(<%= idx %>)" class="text-xs text-blue-500 mt-1 hover:underline">ì ‘ê¸°</button>
      <script>
        (function() {
          var el = document.getElementById('summary-<%= idx %>');
          if (el && typeof marked !== 'undefined') {
            el.innerHTML = marked.parse(el.textContent);
          }
        })();
      </script>
      <% } %>

      <div class="flex items-center gap-3 mt-3 text-xs text-gray-400">
        <span><%= article.points || article.score || 0 %></span>
        <span><%= article.numComments || 0 %></span>
        <% if (article.permalink) { %>
        <a href="<%= article.permalink %>" target="_blank" class="hover:text-blue-500">í† ë¡  ë³´ê¸°</a>
        <% } %>
      </div>
    </div>
    <% }); %>
  </div>

<% } else if (curation && curation.articles.length === 0) { %>
  <div class="text-center py-12">
    <div class="text-4xl mb-3">ğŸ“‹</div>
    <h2 class="text-lg font-bold text-gray-500 mb-1">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ìˆ˜ì§‘ëœ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
    <p class="text-sm text-gray-400">í‚¤ì›Œë“œë¥¼ ì¡°ì •í•˜ê±°ë‚˜ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°ë¥¼ ì‹œë„í•´ ë³´ì„¸ìš”.</p>
  </div>
<% } else { %>
  <div class="text-center py-20">
    <div class="text-6xl mb-4">ğŸ“­</div>
    <h2 class="text-xl font-bold text-gray-600 mb-2">ì•„ì§ íë ˆì´ì…˜ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
    <p class="text-gray-500 mb-4">ìƒë‹¨ì˜ "ì§€ê¸ˆ ê°€ì ¸ì˜¤ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« íë ˆì´ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
  </div>
<% } %>

<%- include('footer') %>
